# 负载均衡与高可用性 {#concept_tvg_jjw_wdb .concept}

阿里云负载均衡（Server Load Balancer，简称SLB）是将访问流量根据转发策略分发到后端多台云服务器ECS的流量分发控制服务。通过使用负载均衡，您可以提高云服务ECS的可用性。

## 应用场景 {#section_mnt_qkw_wdb .section}

在以下应用场景中，建议您搭配使用负载均衡SLB。

-   **高访问量业务** 

    若应用访问量很高，您可以配置监听规则将流量分发到不同的ECS实例上。此外，您可以使用会话保持功能将同一客户端的请求转发到同一台后端ECS，提高访问效率。

-   **横向扩张系统** 

    根据业务发展需要，通过随时添加和移除ECS实例来扩展应用系统的服务能力，适用于各种Web服务器和应用服务器。详情请参见[添加后端服务器](../../../../intl.zh-CN/用户指南/后端服务器/后端服务器概述.md#)。

-   **消除单点故障** 

    您可以在负载均衡实例下添加多台ECS实例。当其中一部分ECS实例发生故障后，负载均衡会自动屏蔽故障的ECS实例，将请求分发给正常运行的ECS实例，保证应用系统正常工作。

-   **同城容灾（多可用区容灾）** 

    使用负载均衡时，您可以将负载均衡实例部署在支持多可用区的地域以实现同城容灾。通过该特性可实现当可用区机房发生故障时，负载均衡能在较短时间内，将前端访问流量切换到同一地域下的其它可用区，恢复服务能力。

    **说明：** 如果您在每个可用区均至少添加了一台ECS实例，负载均衡服务的效率将达到最高。

-   **异地容灾（跨地域容灾）** 

    您可以在不同地域下部署负载均衡实例，并分别挂载相应地域内不同可用区的ECS。上层利用云解析做智能DNS，将域名解析到不同地域的负载均衡实例服务地址下，可实现全局负载均衡。当某个地域出现不可用时，暂停对应解析即可实现所有用户访问不受影响。


## 准备工作 {#section_unt_qkw_wdb .section}

在使用负载均衡前，您需要做好以下准备：

-   规划负载均衡实例的地域

    阿里云提供包括华北、华东、华南、亚太东南、亚太东北、欧洲中部、美国东部、美国西部、香港、中东东部在内的不同地域的负载均衡服务。

    **说明：** 

    -   为了减少延迟并提高下载速度，建议选择距离您的客户最近的地域。
    -   由于负载均衡不支持跨地域部署，因此应选择与后端ECS实例相同的地域（提前规划好部署地域）。
-   选择负载均衡实例的类型（公网或私网）

    根据您的业务类型，确定负载均衡的实例类型。负载均衡实例创建后，系统会根据实例类型分配一个公网服务地址或私网服务地址。

    -   公网负载均衡实例仅提供公网IP，可以通过互联网访问负载均衡服务。
    -   私网负载均衡实例仅提供阿里云私网IP，只能通过阿里云内部网络访问该负载均衡服务，无法从互联网访问。私网类型的负载均衡实例不收取公网带宽费用。
-   选择监听协议

    负载均衡提供4层（TCP协议和UDP协议）和7层（HTTP协议和HTTPS协议）监听。

    -   4层监听将请求直接转发给后端服务器，不会修改标头（Header）。客户端请求到达负载均衡监听后，负载均衡服务器会使用监听中配置的后端端口与后端ECS实例建立TCP连接。
    -   7层监听原理上是反向代理的一种实现。客户端请求到达负载均衡监听后，负载均衡服务器会通过与后端ECS实例建立TCP连接，即再次通过新TCP连接（HTTP协议）访问后端，而不是直接转发报文到后端ECS实例。
    由于7层监听比4层监听在底层实现上多了一个Tengine处理环节，因此，7层监听性能没有4层好。此外，客户端端口不足、后端服务器连接过多等场景也可能导致7层服务性能不高，如果您对性能有很高的要求，建议您使用4层监听。

-   准备后端服务器

    您需要在负载均衡实例中添加ECS实例来处理前端监听转发的请求。在创建负载均衡前，您需要创建好ECS实例并部署相关应用。创建ECS实例时，请注意：

    -   ECS实例的地域和可用区

        确保ECS实例的地域和负载均衡实例的地域相同。此外，建议您将ECS部署在不同的可用区内，提高本地可用性。

    -   ECS实例配置

        在ECS实例上部署好应用后，不需要再进行特别的配置。但如果您要配置一个4层监听（TCP协议或UDP协议），并且ECS实例使用的是Linux系统，请确保net.ipv4.conf文件中的以下3个参数的值为0：

        ```
        net.ipv4.conf.default.rp_filter = 0
        net.ipv4.conf.all.rp_filter = 0
        net.ipv4.conf.eth0.rp_filter = 0
        ```

    -   ECS实例部署

        目前负载均衡实例后端可配置的ECS实例数量没有限制。但是，为了保证对外服务的稳定与高效，建议您根据业务分类或应用服务的模块划分，将提供不同服务或执行不同任务的ECS实例添加到不同的负载均衡实例中。


## 操作步骤 {#section_vny_jsw_wdb .section}

1.  创建ECS实例。使用负载均衡服务前，您至少需要创建两台ECS实例。详情请参见[创建ECS实例](../../../../intl.zh-CN/实例/创建实例/使用向导创建实例.md#)。
2.  创建ECS实例后，您需要在ECS上部署相关应用。
3.  创建负载均衡实例。一台负载均衡实例可以添加多个监听和后端服务器。详情请参见[创建负载均衡实例](../../../../intl.zh-CN/快速入门/创建负载均衡实例.md#)。
4.  创建负载均衡实例后，您需要添加至少一个监听和一组后端服务器。详情请参见[配置负载均衡实例](../../../../intl.zh-CN/快速入门/配置负载均衡实例.md#)。

## 计费说明 {#section_h4t_qkw_wdb .section}

负载均衡支持按流量计费，根据负载均衡实例类型和性能类型的不同，具体的收费项也不同。详情请参见[负载均衡计费](https://www.alibabacloud.com/help/doc-detail/74809.htm)。

