# 扩容系统盘 {#concept_kj1_mqg_ydb .concept}

随着业务发展，如果您需要扩大系统盘容量，可以通过更换系统盘功能实现。本文仅描述如何在不更换操作系统镜像的情况下扩大系统盘容量，扩容后旧盘释放，但原有数据会保留。

**说明：** 在扩容系统盘的同时，您也可以更换操作系统。具体操作，请参见 [更换操作系统](intl.zh-CN/用户指南/实例/更换操作系统.md#)。

## 注意事项 {#section_bff_fwh_ydb .section}

更换系统盘是一个高风险操作，所以，在更换系统盘之前，请务必认真阅读以下注意事项。

**风险**

更换系统盘存在如下风险：

-   旧的系统盘会被释放，建议您提前 [创建快照](intl.zh-CN/用户指南/快照/创建快照.md#) 备份数据。创建快照时注意以下限制：
    -   避免在您的业务高峰期创建快照，以免影响业务。一个40 GiB的快照，第一次创建大约需要40分钟。因此请预留出足够的时间。而且，创建快照可能会降低块存储I/O性能（一般在10%以内），出现短暂瞬间变慢。
    -   为系统盘创建快照时，请确保系统盘有足够的空间，建议预留1 GiB的空间，否则系统盘扩容更换后，系统可能无法正常启动。
-   更换系统盘需要停止实例，因此会中断您的业务。
-   更换完成后，您需要在新的系统盘中重新部署业务运行环境，有可能会对您的业务造成长时间的中断。
-   更换系统盘是重新为您的实例分配一个系统盘，云盘ID会改变，所以基于旧的系统盘创建的快照将不能用于回滚新的系统盘。

    **说明：** 更换系统盘后，您手动创建的快照不受影响，您仍可以用这些快照创建自定义镜像。如果您为旧的系统盘设置了自动快照策略，而且设置了自动快照随云盘释放，则自动快照策略不再适用于新的系统盘，而且，旧系统盘的自动快照会自动删除。


**限制和说明**

更换系统盘时，您需要注意以下信息：

-   更换系统盘后，您的实例会被分配一个新的系统盘，系统盘ID会更新，原系统盘被释放。
-   您不能更换系统盘的云盘类型。
-   扩容后的系统盘，容量最小为扩容前的容量，最大为500 GiB。不能缩小系统盘的容量。
-   Windows 2003不支持系统盘扩容。
-   如果您的包年包月实例做过 [续费降配](../../../../intl.zh-CN/产品定价/续费实例/续费降配.md#) 操作，进入下一个计费周期前，您不能修改系统盘容量。
-   实例的IP地址和MAC地址不变。
-   为了保证有足够的快照额度完成新系统盘的自动快照策略，您可以删除不需要的旧系统盘快照。详细操作，请参见 [删除快照和自动快照策略](intl.zh-CN/用户指南/快照/删除快照和自动快照策略.md#)。

## 操作步骤 {#section_hff_fwh_ydb .section}

按以下步骤，在保留原来系统盘内容的情况下扩容系统盘：

1.  登录 [ECS管理控制台](https://ecs.console.aliyun.com/#/home)。
2.  在左侧导航栏中，单击 **实例**。
3.  选择地域。
4.  找到需要扩容系统盘的实例，单击实例ID，进入 实例详情 页。
5.  按以下步骤为系统盘创建快照：
    1.  在左侧导航栏中，单击 **本实例磁盘**。
    2.  找到系统盘，在 **操作** 列中，单击 **创建快照**。

        **说明：** 关于创建快照的详细操作限制或注意事项，请参见 [创建快照](intl.zh-CN/用户指南/快照/创建快照.md#)。

6.  按以下步骤使用系统盘快照创建自定义镜像：
    1.  在左侧导航栏中，单击 **本实例快照**，查看快照的创建进度和状态。当进度为100%，状态显示为 **成功** 时，在 **操作** 列中，单击 **创建自定义镜像**。

        **说明：** 

        -   关于创建自定义镜像的详细操作限制或注意事项，请参见 [使用快照创建自定义镜像](intl.zh-CN/用户指南/镜像/创建自定义镜像/使用快照创建自定义镜像.md#)。
        -   在更换系统盘时，通过该方式得到的镜像会出现在 **自定义镜像** 的下拉列表里。
    2.  返回到 实例列表 页，在左侧导航栏里，选择 **快照和镜像** \> **镜像**，查看自定义镜像的创建进度和状态。
7.  当自定义镜像创建进度为100%，状态显示为 **可用** 时，在左侧导航栏里，单击 **实例**。
8.  找到需要操作的实例，在 **操作** 列中，选择 **更多** \> **实例状态** \> **停止**。

    **说明：** 如果是按量付费的VPC类型实例，而且已经开启了 [按量付费实例停机不收费](../../../../intl.zh-CN/产品定价/按量付费实例停机不收费.md#) 功能，在 提醒 弹出框中，单击 **确定**。在 停止实例 对话框中，选择 **停止后仍旧保留实例并继续收费**。如果使用 **停机不收费** 模式，更换系统盘后可能无法成功启动实例。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/9676/15444955355328_zh-CN.png)

9.  当实例的状态显示为 **已停止** 时，在 **操作** 列中，选择 **更多** \> **磁盘和镜像** \> **更换系统盘**。
10. 在弹出的对话框里，仔细阅读更换系统盘注意事项后，单击 **确定，更换系统盘**。
11. 在 更换系统盘 页面上，
    1.  **镜像类型**：从 **自定义镜像** 里选择刚创建的自定义镜像。
    2.  **系统盘**：根据业务需求修改系统盘容量，最大可以扩容到500 GiB。扩容时能设置的最小容量与系统盘当前容量和镜像有关，如下表所示。

        |镜像|扩容的容量限制（GiB）|
        |:-|:-----------|
        |Linux（不包括CoreOS）+ FreeBSD|\[Max\{20, 系统盘当前容量\}, 500\]|
        |CoreOS|\[Max\{30, 系统盘当前容量\}, 500\]|
        |Windows|\[Max\{40, 系统盘当前容量\}, 500\]|

        **说明：** 不能修改系统盘的云盘类型。

    3.  **安全设置**：
        -   如果是Windows系统，您只能使用密码认证。
        -   如果您的实例是I/O优化实例，而且是Linux系统，您可以选择使用密码认证或SSH密钥对认证。您可以设置登录密码或者绑定SSH密钥对。
    4.  确认 **配置费用**：包括了镜像的价格与系统盘的价格。请详见 [云产品价格页](https://www.alibabacloud.com/zh/product/ecs#pricing)。
    5.  确认无误后，单击 **确定更换**。

您可以通过控制台监控系统状态，大概需要10分钟左右完成操作系统更换。完成后，实例会自动启动。

## 后续操作 {#section_xff_fwh_ydb .section}

更换系统盘后，您可能需要做以下操作：

-   如果Linux系统，而且，实例挂载了数据盘并设置了开机自动挂载：更换系统盘后，原来系统盘中的文件系统挂载信息丢失，您必须在新系统盘的/etc/fstab文件写入新分区信息，并挂载文件系统，但是不需要对数据盘格式化并分区。操作步骤如下，具体的操作命令参见 [Linux 格式化数据盘](../../../../intl.zh-CN/个人版快速入门/步骤 4：格式化数据盘/Linux 格式化数据盘.md#)：
    1.  （建议）备份 /etc/fstab。
    2.  向 /etc/fstab 写入新分区信息。
    3.  查看 /etc/fstab 中的新分区信息。
    4.  挂载文件系统。
    5.  查看目前云盘空间和使用情况：运行命令`df -h`。

        挂载操作完成后，不需要重启实例即可开始使用新的文件系统。

-    [为磁盘设置自动快照策略](intl.zh-CN/用户指南/快照/为磁盘设置自动快照策略.md#)。自动快照策略与云盘ID绑定。更换了新的系统盘后，旧云盘上应用的自动快照策略自动失效。您需要对新系统盘设置自动快照策略。

