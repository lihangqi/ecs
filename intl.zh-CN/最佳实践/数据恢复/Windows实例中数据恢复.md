# Windows实例中数据恢复 {#concept_52020_zh .concept}

在处理磁盘相关问题时，您可能会碰到操作系统中数据盘分区丢失的情况。本文介绍了Windows系统下常见的数据盘分区丢失的问题以及对应的处理方法，同时提供了使用云盘的常见误区以及最佳实践，避免可能的数据丢失风险。

## 前提条件 {#section_rnp_qyf_hfb .section}

在修复数据前，您必须先对丢失分区的数据盘创建快照，在快照创建完成后再尝试修复。如果在修复过程中出现问题，您可以通过快照回滚将数据盘还原到修复之前的状态。

## 工具说明 {#section_fnl_ryf_hfb .section}

在Windows实例里，您可以选择以下任一种工具恢复数据盘数据：

-   磁盘管理：Windows系统自带工具，主要用于分区格式化数据盘等。
-   数据恢复软件：一般是商业软件，您可以去相应的官网下载使用。主要作用是文件系统异常恢复数据。

## 磁盘显示为“外部”，无法显示分区 {#section_hnl_ryf_hfb .section}

在Windows系统中，您在 磁盘管理器 中看到磁盘显示为 **外部**，而且不显示分区情况，如下图所示。

![](images/13067_zh-CN_source.png)

此时，按以下方式处理：

在 **外部** 磁盘处，右键单击右边的空白处，选择 **导入外部磁盘**，再单击 **确定**。

![](images/13068_zh-CN_source.png)

## 磁盘显示为“脱机”，无法显示分区 {#section_knl_ryf_hfb .section}

在Windows系统中，您在 磁盘管理器 中看到磁盘显示为 **脱机**，而且不显示分区情况，如下图所示。

![](images/13069_zh-CN_source.png)

此时，按以下方式处理：

在 **脱机** 磁盘处，右键单击磁盘名称（如上图中的 **磁盘1**）周边的空白区，在弹出菜单中，选择 **联机**，再单击 **确定**。

![](images/13070_zh-CN_source.png)

## 未分配盘符，无法显示分区 {#section_nnl_ryf_hfb .section}

在Windows系统中，您在 磁盘管理器 中能看到数据盘的信息，但数据盘未分配盘符，如下图所示。

![](images/13071_zh-CN_source.png)

此时，按以下方式处理：

右键单击磁盘（如上图所示的 **磁盘1**）的主分区，在弹出菜单中，选择 **更改驱动器号和路径**，并按提示完成操作。

![](images/13072_zh-CN_source.png)

## 在磁盘管理器无法查看数据盘，报错“枚举存储期间出错” {#section_qnl_ryf_hfb .section}

在Windows系统中，您在 磁盘管理器 里无法查看数据盘。系统日志里报错“枚举存储期间出错”，如下图所示。

**说明：** 操作系统的版本不同，报错内容也可能是“枚举卷期间出错”。

![](images/13073_zh-CN_source.png)

此时，按以下步骤处理：

1.  启动Windows PowerShell。
2.  运行命令 winrm quickconfig 进行修复。当界面上询问“执行这些更改吗\[y/n\]?”时，输入 y 确认执行。

    ![](images/13074_zh-CN_source.png)


修复完成后，再打开 磁盘管理器，一般数据盘已经能正常显示。

![](images/13075_zh-CN_source.png)

## 数据盘变成RAW格式 {#section_vnl_ryf_hfb .section}

在某些特殊情况下，您可能会发现Windows下磁盘变为RAW格式。

磁盘显示为RAW格式是因为Windows无法识别磁盘上的文件系统。一般是因为记录文件系统类型或者位置的信息丢失或者损坏，比如partition table或者boot sector。以下列出了一些比较常见的原因：

-   外接硬盘发生这种问题通常是因为没有使用 **Safely remove hardware** 选项断开磁盘。
-   意外断电导致的磁盘问题。
-   硬件层故障也可能导致磁盘分区信息丢失。
-   底层与磁盘相关的驱动或应用，例如您使用的diskprobe工具就可以直接修改磁盘的表结构。
-   计算机病毒。

您可以参考微软官方的 [Dskprobe Overview](https://technet.microsoft.com/en-us/library/cc736327(v=ws.10).aspx) 文档修复磁盘。

此外，Windows下有大量免费或商业的数据恢复软件可用于找回丢失的数据。例如，您可以尝试使用Disk Genius工具扫描，来尝试恢复相应的文件。

## 常见误区和最佳实践 {#section_xnl_ryf_hfb .section}

数据是用户的核心资产，很多用户在ECS上构建网站、自建数据库\(MYSQL/MongoDB/Redis\)。如果出现数据丢失，会给用户的业务带来巨大的风险。如下是在数据安全方面的常见误区和最佳实践。

-   **常见误区**

    阿里云的底层存储基于 [三副本](../../../../intl.zh-CN/产品简介/块存储/云盘三副本技术.md#)，因此有些用户认为操作系统内数据没有任何丢失风险。实际上这是误解。底层存储的三副本提供对数据磁盘的物理层保护，但是，如果系统内部使用云盘逻辑上出现问题，比如中毒、误删数据、文件系统损坏等情况，还是可能出现数据丢失。此时，您需要通过快照、异地备份等相关技术最大保证数据的安全性。

-   **最佳实践**

    数据盘分区恢复以及数据恢复是处理数据丢失问题最后的一道防线，但未必一定能够恢复数据。强烈建议您参考如下最佳实践，通过对数据创建快照（自动或手动）以及各类备份方案，最大程度地保证数据的安全性。

    -   **启用自动快照**

        根据实际业务，对系统盘、数据盘创建自动快照。注意，在更换系统盘、实例到期后或手动释放磁盘时，自动快照可能会被释放。

        您可以在ECS控制台上通过 修改磁盘属性 选择 **自动快照随磁盘释放**。如果想保留自动快照，您可以手动去掉该选项。

        详情请参考：[ECS云服务器自动快照FAQ](https://www.alibabacloud.com/help/zh/faq-detail/40552.htm)。

    -   **创建手动快照**

        在做下列重要或有风险的操作前，请手动为磁盘创建快照。例如：

        -   系统升级内核
        -   应用升级变更
        -   磁盘数据恢复
        在恢复磁盘时，一定要先对磁盘创建快照，快照完成后做相应的操作。

    -   **OSS、线下、异地备份**

        您可酌情使用OSS、线下、异地等方式备份重要数据。


