# 更换系统盘（非公共镜像） {#concept_vbb_ckj_ydb .task}

更换系统盘是指为您重新分配一个系统盘，原来的系统盘会被释放，系统盘ID会更新。如果在创建ECS实例时选择了错误的操作系统，或者随着业务发展，需要扩大系统盘容量或者使用其他操作系统，您可以通过更换系统盘实现。

将系统盘的镜像更换为非公共镜像之前，您必须先完成以下工作：

-   如果更换为自定义镜像：
    -   如果要使用某台ECS实例上的镜像，您必须对指定实例的系统盘创建快照，并使用快照创建自定义镜像。具体操作，请参见[创建快照](../cn.zh-CN/快照/使用快照/创建快照.md#)和[使用快照创建自定义镜像](cn.zh-CN/镜像/自定义镜像/创建自定义镜像/使用快照创建自定义镜像.md#)。如果这台实例与您要更换系统盘的实例不在同一个地域，您需要复制镜像。具体操作，请参见[复制镜像](../cn.zh-CN/镜像/自定义镜像/复制镜像.md#)。
    -   如果要使用本地物理镜像文件，您需要在控制台导入镜像或者使用Packer创建并导入镜像。镜像所在地域必须与您的实例相同。具体操作，请参见[导入自定义镜像](../cn.zh-CN/镜像/自定义镜像/导入镜像/导入自定义镜像.md#)和[使用Packer创建自定义镜像](../cn.zh-CN/镜像/自定义镜像/创建自定义镜像/使用Packer创建自定义镜像.md#)。
    -   如果要使用其他地域的镜像，您需要先复制镜像。具体操作，请参见[复制镜像](../cn.zh-CN/镜像/自定义镜像/复制镜像.md#)。

        **说明：** 通过上述方式创建的镜像，在更换系统盘时，都出现在**自定义镜像**的列表里。

-   如果要使用其他阿里云账号的镜像，您必须先获得共享镜像。具体操作，请参见[共享镜像](cn.zh-CN/镜像/自定义镜像/共享镜像.md#)。
-   如果更换为Linux系统，而且选择SSH密钥对认证，您必须先创建SSH密钥对。具体操作，请参见[创建 SSH 密钥对](cn.zh-CN/安全/SSH密钥对/使用SSH密钥对.md#)。
-   更换系统盘是一个高危操作，可能会造成数据丢失或业务停止。为了最大限度地减少更换系统盘对您业务的影响，建议在更换系统盘之前先为当前系统盘创建快照。详细步骤请参见[创建快照](../cn.zh-CN/快照/使用快照/创建快照.md#)。
-   如果要对Windows Server系统ECS实例更换系统盘，请确保系统盘有足够的空间。建议预留1GiB的空间，否则更换系统盘后，系统可能无法正常启动。

**说明：** 避免在您的业务高峰期创建快照，以免影响业务。一个40GiB的快照，第一次创建大约需要40分钟。因此请预留出足够的时间。而且，创建快照可能会降低块存储I/O性能（一般在10%以内），出现短暂瞬间变慢。

您可以在更换系统盘时为ECS实例选择公共镜像、共享镜像、自定义镜像或镜像市场里的任一种镜像。 本文介绍如何将系统盘的镜像更换为非公共镜像。如果您需要使用公共镜像，请参见[更换系统盘（公共镜像）](cn.zh-CN/块存储/云盘/更换系统盘/更换系统盘（公共镜像）.md#)。

**说明：** 微软已经停止支持Windows Server 2003。为了保证您的数据安全，阿里云不推荐ECS实例继续使用Windows Server 2003系统，也不再提供这个镜像。更多信息，请参见[关于阿里云不再支持Windows Server 2003系统镜像](https://help.aliyun.com/document_detail/59513.html)。

更换系统盘是一个高危操作，可能会造成数据丢失或业务停止。您必须认真阅读以下注意事项：

-   更换系统盘之前
    -   原系统盘的会被释放，建议您提前创建快照备份数据。具体操作，请参见[创建快照](../cn.zh-CN/快照/使用快照/创建快照.md#)。
    -   更换系统盘需要停止实例，因此会中断您的业务。具体操作，请参见[启动和停止实例](../cn.zh-CN/实例/管理实例/启动和停止实例.md#)。
    -   为了保证有足够的快照额度完成新系统盘的自动快照策略，您可以删除不需要的历史系统盘快照。具体操作，请参见[删除快照](../cn.zh-CN/快照/使用快照/删除快照.md#)。
    -   不能更换系统盘的云盘类型。
-   更换系统盘之后
    -   ECS实例IP地址和MAC地址不变。
    -   云盘ID会改变，ECS实例会被分配一个新的系统盘，历史系统盘被释放。
    -   历史系统盘快照不能用于回滚新的系统盘。
    -   手动创建的快照不受影响，您仍能用历史系统盘快照创建自定义镜像。
    -   历史系统盘如果设置了自动快照策略，而且设置了自动快照随磁盘释放，历史系统盘的自动快照会自动删除。历史自动快照策略不再适用于新的系统盘，需要您重新设置。
    -   需要您重新部署业务运行环境，有可能会对您的业务造成长时间的中断。
-   跨操作系统更换系统盘

    **说明：** 跨操作系统更换系统盘是指互相互换Linux和Windows Server系统，跨操作系统更换系统盘后，ECS实例无法识别数据盘的文件系统格式。非中国大陆地域不支持跨操作系统更换系统盘，仅支持Linux不同发行版本或Windows Server不同版本之间的更换。

    -   如果数据盘没有重要数据，您可以重新初始化数据盘，再为数据盘创建相应系统支持的文件系统。具体操作，请参见[重新初始化数据盘](cn.zh-CN/块存储/云盘/重新初始化云盘/重新初始化系统盘.md#)。
    -   如果数据盘上有重要数据，您可以做以下操作：
        -   Windows Server系统更换为Linux系统：单独安装软件识别，例如NTFS-3G等，因为Linux缺省情况下无法识别NTFS格式。
        -   Linux系统更换为Windows Server系统：单独安装软件识别，例如Ext2Read和Ext2Fsd等，因为Windows Server缺省情况下无法识别ext3、ext4、xfs等文件系统格式。
        -   Windows Server系统更换为Linux系统：您能选择使用密码认证或SSH密钥对认证。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。
2.  在左侧导航栏，选择**实例与镜像** \> **实例**。
3.  在顶部状态栏处，选择地域。
4.  找到需要更换系统盘的实例，在**操作**列中，单击**更多** \> **实例状态** \> **停止**。 当实例状态变为**已停止**时，表示实例已经成功停止。
5.  在**操作**列中，单击**更多** \> **磁盘和镜像** \> **更换系统盘**。
6.  在弹出的对话框里，仔细阅读更换系统盘注意事项后，单击**确定，更换系统盘**。
7.  在更换系统盘页面上，配置以下参数。 
    1.  **镜像类型**：选择**自定义镜像**、**共享镜像**或**镜像市场**，并选择需要的镜像。
    2.  **系统盘**：不能更换系统盘的云盘类型，但是您能根据业务需求和新镜像的需求扩容系统盘，最大容量为500GiB。扩容时能设置的最小容量与系统盘当前容量和镜像有关，如下表所示。 

        |镜像|扩容的容量限制（GiB）|
        |:-|:-----------|
        |Linux（不包括CoreOS）+ FreeBSD|\[Max\{20, 系统盘当前容量\}, 500\]|
        |CoreOS|\[Max\{30, 系统盘当前容量\}, 500\]|
        |Windows Server|\[Max\{40, 系统盘当前容量\}, 500\]|

        **说明：** 如果您操作过续费降配，进入下一个计费周期前，您不能修改系统盘容量。

    3.  **安全设置**： 
        -   如果新的操作系统是Windows Server系统，您只能使用密码认证。
        -   如果您的实例是I/O优化实例，而且新的操作系统是Linux系统，您可以选择使用密码认证或SSH密钥对认证。您必须设置登录密码或者绑定SSH密钥对。
    4.  确认**配置费用**：一般是指系统盘的费用。系统盘价格，请参见[云产品价格页](https://www.aliyun.com/price/product#/ecs/detail)。如果您选择的自定义镜像来源于镜像市场，可能会产生费用，也包括在配置费用里。镜像的计费信息，请参见[计费概览](../cn.zh-CN/产品定价/计费概览.md#)。 

        **说明：** 系统盘价格说明：系统盘按起始容量起售，按起售价收费，超过起始容量后，每增加1GiB按线性计费价格收费。起始容量的系统盘，包年包月价格的单位为元/月，按量付费价格的单位为元/小时。

    5.  确认无误后，单击**确定更换**。

登录ECS控制台监控实例状态，更换系统盘大概需要10分钟。完成后，实例会自动启动。

更换系统盘后，您可能需要做以下操作：

-   （可选）历史系统盘应用的自动快照策略自动失效。您需要为新系统盘设置自动快照策略。具体操作，请参见[执行或取消自动快照策略](../cn.zh-CN/快照/使用自动快照策略/执行或取消自动快照策略.md#)。
-   如果更换前后都是Linux系统，而且，实例上原来挂载了数据盘并设置了开机自动挂载分区。更换系统盘后，历史系统盘中的数据盘分区挂载信息丢失。您必须在新系统盘的/etc/fstab文件写入新分区信息，并挂载分区，不需要对数据盘格式化并分区。操作步骤如下，具体的操作命令，请参见[Linux格式化数据盘](../cn.zh-CN/个人版快速入门/格式化数据盘/Linux格式化数据盘.md#)。

    1.  （建议）备份/etc/fstab。
    2.  向/etc/fstab写入新分区信息。
    3.  查看/etc/fstab中的新分区信息。
    4.  运行mount命令挂载分区。
    5.  运行命令`df -h`查看文件系统空间和使用情况。
    完成挂载分区后，无需重启ECS实例即可开始使用新的数据盘。


**相关文档**  


[ReplaceSystemDisk](../cn.zh-CN/API参考/磁盘/ReplaceSystemDisk.md#)

