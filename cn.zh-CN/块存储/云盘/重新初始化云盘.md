# 重新初始化云盘 {#concept_stg_xd3_ydb .concept}

当云盘挂载在ECS实例上时，您可以使用 **重新初始化磁盘** 功能将作系统盘或数据盘用的云盘恢复到创建时的状态。重新初始化后：

-   系统盘会恢复到刚创建时的状态。比如，如果您用公共镜像Windows Server 2008 R2创建实例，那么，重新初始化系统盘后，操作系统依然是最初的Windows Server 2008 R2，但是创建实例后安装的应用程序和产生的数据都会被删除。

    **说明：** 更换系统盘后再执行初始化，初始化的是更换后的系统盘，而不是更换前的系统盘。

-   作数据盘用的云盘会恢复到初始状态：
    -   如果原来是空盘，则恢复为空盘。
    -   如果是 [通过快照创建的云盘](cn.zh-CN/块存储/云盘/创建云盘/使用快照创建云盘.md#)，则会恢复到快照的状态。
-   如果云盘应用了自动快照策略，重新初始化后，设置仍然有效，不需要重新设置。
-   重新初始化磁盘不会更改ECS实例的IP地址、云盘ID。
-   重新初始化磁盘不会删除云盘的自动快照或手动快照，您可以使用这些快照 [回滚云盘](cn.zh-CN/块存储/云盘/回滚云盘.md#)。

**警告：** 

-   重新初始化磁盘前必须先停止ECS实例，该操作会中断您的服务，请务必谨慎操作。
-   重新初始化磁盘后，云盘上的数据将会丢失，请务必提前做好数据备份，例如为云盘创建快照，详细操作，请参见 [创建快照](cn.zh-CN/快照/使用快照/创建快照.md#)。

## 重新初始化系统盘 {#InitSys .section}

**前提条件**

初始化Linux实例的系统盘时，如果使用密钥对验证，您必须已经 [创建 SSH 密钥对](cn.zh-CN/安全/SSH密钥对/使用SSH密钥对.md#) 或 [导入 SSH 密钥对](cn.zh-CN/隐藏/新架构后需要隐藏的文档汇总/安全/导入 SSH 密钥对.md#)。

 **操作步骤** 

按以下步骤重新初始化系统盘：

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。
2.  在左侧导航栏，选择**实例与镜像** \> **实例**。
3.  在顶部状态栏处，选择地域。
4.  找到需要初始化系统盘的实例，单击实例ID进入 实例详情 页。
5.  在页面右上角，单击 **停止**，停止实例。

    **说明：** 如果是按量付费的VPC类型实例，而且已经开启了 [按量付费实例停机不收费](../cn.zh-CN/产品定价/按量付费实例停机不收费.md#) 功能，在 提醒 弹出框中，单击 **确定**。在 停止实例 对话框中，选择 **停止后仍旧保留实例并继续收费**。如果使用 **停机不收费** 模式，重新初始化系统盘后可能无法成功启动实例。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/9676/15597856935328_zh-CN.png)

6.  实例进入 **已停止** 状态后，在左侧导航栏中，单击 **本实例磁盘**。
7.  找到系统盘，在 **操作** 列中，单击 **重新初始化磁盘**。
8.  在弹出的 重新初始化磁盘 对话框里，完成以下设置：
    1.  设置验证方法：
        -   Windows实例：重新设置实例登录密码。可以使用旧的密码，也可以指定新的密码。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/9679/15597856935382_zh-CN.png)

        -   Linux实例：选择 **设置密钥** 或 **设置密码**，并绑定密钥对或重新设置密码。可以使用旧的密码，也可以指定新的密码。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/9679/15597856935383_zh-CN.png)

    2.  （可选）**安全加固**：选择 **免费开通**。开通安全加固功能后，您的实例会自动免费加载云服务器安全组件，提供网站后门检测、异地登录提醒、暴力破解拦截等安全功能。
    3.  （可选）**启动实例策略**：选择 **重置磁盘后启动**。完成初始化后，实例会自动启动。
    4.  单击 **确认重新初始化磁盘**。
9.  仅适用于主账号用户：获取并输入手机短信验证码后，单击 **确认**，开始初始化系统盘。
10. 仅适用于Linux实例：如果初始化前挂载了数据盘，您需要 [重新创建挂载点信息并挂载文件系统](https://help.aliyun.com/document_detail/40580.html)。

    **说明：** 在Linux实例中，重新初始化系统盘不会改变数据盘里的内容，但是数据盘的挂载信息会丢失，所以需要执行这步操作。


系统盘重新初始化后，您需要重新部署业务（包括应用和配置）从而尽快恢复业务。

## 重新初始化数据盘 {#InitData .section}

重新初始化后，数据盘的状态根据云盘最初的状态以及实例的操作系统不同而异：

-   Windows实例：无论数据盘是从快照创建而来，还是一个全新的空盘，重新初始化后，数据盘会恢复到创建后的初始状态，但是可以直接使用，不需要执行其他操作。
-   Linux实例：
    -   如果数据盘创建时是一个空盘：数据盘的文件系统及内容完全丢失，您必须重新格式化、分区数据盘，并挂载数据盘分区。

        **说明：** 在这种情况下，如果重新初始化前您在 /etc/fstab 文件中写入了开机自动挂载分区的命令，那么，重新初始化后，开机自动挂载会失效，启动时一般会出现异常。所以，在重新初始化数据盘之前，您必须先在 /etc/fstab 中注释掉开机自动挂载数据盘分区的信息。

    -   如果数据盘是从快照创建而来：数据盘会恢复到原来快照的状态，不需要重新挂载数据盘分区，但是数据盘创建成功后产生的所有数据都会丢失。

本文的步骤描述中用/dev/vdb1表示数据盘分区，/InitTest表示挂载点。您可以根据实际情况替换。

**前提条件**

云盘已经挂载到实例上。详细操作，请参见 [挂载云盘](cn.zh-CN/块存储/云盘/挂载云盘.md#)。

**操作步骤**

按以下步骤重新初始化数据盘：

1.  仅适用于Linux实例：如果数据盘创建时是一个空盘，而且您在/etc/fstab 中添加了开机自动挂载数据盘分区的命令，那么，您必须在 /etc/fstab 里注释掉开机挂载数据盘分区的命令。操作步骤如下：
    1.  [远程连接Linux实例](cn.zh-CN/实例/连接实例/连接方式导航.md#)。
    2.  运行 `vim /etc/fstab`。
    3.  按 `i` 键进入编辑模式。
    4.  找到数据盘分区挂载信息，加 \# 注释掉挂载信息，如下所示。

        ``` {#codeblock_b7t_nwy_t8q}
        # /dev/vdb1 /InitTest ext3 defaults 0 0
        ```

    5.  按 `Esc` 键退出编辑模式，输入 :wq 保存并退出。
2.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。
3.  在左侧导航栏，选择**实例与镜像** \> **实例**。
4.  在顶部状态栏处，选择地域。
5.  找到需要初始化数据盘的实例，单击实例ID进入 实例详情 页。
6.  在页面右上角，单击 **停止**，停止实例。

    **说明：** 如果是按量付费的VPC类型实例，而且已经开启了 [按量付费实例停机不收费](../cn.zh-CN/产品定价/按量付费实例停机不收费.md#) 功能，在 提醒 弹出框中，单击 **确定**。在 停止实例 对话框中，选择 **停止后仍旧保留实例并继续收费**。如果使用 **停机不收费** 模式，重新初始化数据盘后可能无法成功启动实例。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/9676/15597856935328_zh-CN.png)

7.  实例进入 **已停止** 状态后，在左侧导航栏中，单击 **本实例磁盘**。
8.  找到数据盘，在 **操作** 列中，单击 **重新初始化磁盘**。
9.  在弹出的 重新初始化磁盘 对话框里，认真阅读提示后，单击 **确认重新初始化磁盘**。
10. 仅适用于主账号用户：获取并输入手机短信验证码后，单击 **确认**。
11. 在左侧导航栏中，单击 **实例详情**。
12. 在页面右上角，单击 **启动**，启动实例，完成数据盘初始化。
13. 仅适用于Linux实例：如果数据盘创建时是一个空盘，您必须 [Linux格式化数据盘](../cn.zh-CN/个人版快速入门/步骤 4：格式化数据盘/Linux格式化数据盘.md#)。

数据盘重新初始化后，您需要重新部署业务（包括应用和配置）从而尽快恢复业务。

## 相关API {#section_yxg_323_ydb .section}

[ReInitDisk](../cn.zh-CN/API参考/磁盘/ReInitDisk.md#)

