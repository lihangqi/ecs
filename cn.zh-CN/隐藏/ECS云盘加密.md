# ECS云盘加密 {#concept_udk_5wj_ydb .concept}

当您的业务因为安全需求或法规合规要求等原因，需要对存储在云盘上的数据进行加密保护时，您可以使用阿里云ECS云盘加密功能，无需构建、维护和保护自己的密钥管理基础设施，即可保护数据的隐私性和自主性。

本文中的云盘指代云盘和共享块存储。下文中统一简称为云盘，除非特别指出。

## 什么是ECS云盘加密 {#concept .section}

使用ECS云盘加密功能，系统会将从ECS实例传输到云盘的数据自动加密，并在读取数据时自动解密。在加密解密的过程中，云盘的性能几乎没有衰减。关于性能测试方式，请参见[块存储性能](../../../../../cn.zh-CN/块存储/块存储性能.md#)。

在创建加密云盘并将其挂载到ECS实例后，系统将对以下数据进行加密：

-   云盘中的静态数据
-   云盘和实例间传输的数据（实例操作系统内数据不加密）
-   从加密云盘创建的所有快照（即，加密快照）
-   从加密快照创建的所有云盘（即，加密云盘）

## 云盘加密方式 {#dependencies .section}

创建加密云盘时，系统需要使用同一地域的密钥管理服务（KMS）提供的用户主密钥（Customer Master Key，CMK）。因此，首次通过控制台或者API使用ECS云盘加密功能之前，您必须先开通[密钥管理服务](https://www.aliyun.com/product/kms)。

开通KMS后，您可以选择以下两种方式使用CMK：

|方式|描述|费用|
|:-|:-|:-|
|使用系统自建的CMK|当您在一个地域第一次使用加密盘时，ECS系统会自动在KMS的同一地域中创建一个专为ECS使用的CMK。您可以在KMS控制台上查看该CMK，但您不能删除该CMK。|不收取额外费用，也不占用您在每个地域的主密钥数量限制。|
|BYOK（Bring Your Own Key）|您可以在阿里云KMS创建您自己的CMK，并为云盘加密。**说明：** 创建您自己的CMK可为您提供更高的灵活性，包括创建、轮换和禁用密钥以定义访问控制的能力。

|收取费用，详情请参见[费用](#)。|

## ECS云盘加密的密钥管理 {#kms .section}

ECS云盘加密功能通过行业标准的AES-256算法，利用数据密钥加密您的卷。每个阿里云账号在每个地域都具有唯一的用户主密钥（CMK），该密钥与数据分开，存储在一个受严格的物理和逻辑安全控制保护的系统上。

每个地域的新创建云盘都使用这一地域下唯一的256位密钥（来自于CMK）加密。云盘的所有快照以及从这些快照创建的云盘也关联该密钥。这些密钥受阿里云KMS提供的密钥管理基础设施的保护，实施强逻辑和物理安全控制以防止未经授权的访问。阿里云的密钥管理基础设施符合\(NIST\) 800-57中的建议，并使用了符合\(FIPS\) 140-2标准的密码算法。

云盘的加密密钥仅在您的ECS实例所在的宿主机的内存中使用，永远不会以明文形式存储在任何永久介质（如云盘）上。

## 使用限制 {#limits .section}

-   不支持加密系统盘，只支持加密数据盘。
-   不支持加密ESSD云盘和本地盘，只支持加密普通云盘、高效云盘、SSD云盘和共享块存储。
-   已经存在的非加密盘，不能直接转换成加密盘。
-   已经加密的云盘，不能直接转换为非加密云盘。
-   使用已经存在的非加密盘创建的快照，不能直接转换成加密快照。
-   加密快照不能直接转换为非加密快照。
-   不支持共享带有加密快照的镜像。
-   不支持跨地域复制带有加密快照的镜像。
-   不支持导出带有加密快照的镜像。
-   如果使用系统自动创建的（CMK），该CMK不收取费用，但您不能删除它。
-   云盘加密后，不支持更换该云盘关联的用户主密钥。
-   不支持弹性裸金属服务器（神龙）。

## 费用 {#section_r4l_5r5_q8y .section}

|功能/操作|费用|
|:----|:-|
|ECS云盘加密功能|不收取额外的费用。|
|ECS为您在每个地域创建的用户主密钥（CMK）|属于服务密钥，不收取额外费用，也不占用您在每个地域的主密钥数量限制。|
|您自己创建的CMK|属于普通密钥，会产生费用。|
|对云盘的所有读写操作，包括 mount/umount、分区、格式化等|不产生费用。|
|涉及云盘本身的管理操作，无论是通过ECS管理控制台还是通过API，均会以API的形式使用KMS，将会记入到您在该地域的KMS服务API调用次数。对加密云盘的管理操作包括：

-   创建加密盘（[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9857.md\#](../../../../../cn.zh-CN/API参考/实例/CreateInstance.md#)、[RunInstances](../../../../../cn.zh-CN/API参考/实例/RunInstances.md#)或[CreateDisk](../../../../../cn.zh-CN/API参考/磁盘/CreateDisk.md#)）
-   挂载云盘（[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9886.md\#](../../../../../cn.zh-CN/API参考/磁盘/AttachDisk.md#)\)
-   卸载云盘（[DetachDisk](../../../../../cn.zh-CN/API参考/磁盘/DetachDisk.md#)）
-   创建快照（[CreateSnapshot](../../../../../cn.zh-CN/API参考/快照/CreateSnapshot.md#)）
-   回滚云盘（[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9891.md\#](../../../../../cn.zh-CN/API参考/磁盘/ResetDisk.md#)）
-   重新初始化云盘（[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9890.md\#](../../../../../cn.zh-CN/API参考/磁盘/ReInitDisk.md#)）

 | 目前每个用户每月可以免费使用20000次KMS，如果高频率大量操作超过免费额度，则会产生费用。详情请参见[密钥管理服务计费方式](https://help.aliyun.com/document_detail/52608.html)。

 |

**说明：** 请确保您的账户余额充足，否则会出现操作失败，进而产生额外的费用。

## 通过控制台创建加密云盘 {#howtocreate .section}

**方式一：随实例创建加密云盘**

您可以在[创建实例](../../../../../cn.zh-CN/实例/实例生命周期/创建实例/使用向导创建实例.md#)时，通过加密快照添加加密的数据盘，或者使用CMK来添加加密数据盘，如下图所示。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/127723/155142804239704_zh-CN.png)

**方式二：单独创建加密云盘**

您可以在云盘页面通过加密快照创建加密数据盘，或者使用CMK来创建加密数据盘。如何单独创建数据盘，请参见[创建按量付费云盘](../../../../../cn.zh-CN/块存储/云盘/创建云盘/创建按量付费云盘.md#)。

## 通过API创建加密云盘 {#section_ern_2w4_xgb .section}

-   随实例创建时添加数据盘：调用[RunInstances](../../../../../cn.zh-CN/API参考/实例/RunInstances.md#)或[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9857.md\#](../../../../../cn.zh-CN/API参考/实例/CreateInstance.md#)时，指定参数DataDisk.n.Encrypted为true，并同时指定一个KMSKeyId。
-   单独创建数据盘：调用[CreateDisk](../../../../../cn.zh-CN/API参考/磁盘/CreateDisk.md#)时，指定参数Encrypted为true，并同时指定一个KMSKeyId。
-   使用加密快照创建数据盘：调用[RunInstances](../../../../../cn.zh-CN/API参考/实例/RunInstances.md#)、[../../../../../dita-oss-bucket/SP\_2/DNA0011860945/ZH-CN\_TP\_9857.md\#](../../../../../cn.zh-CN/API参考/实例/CreateInstance.md#)或[CreateDisk](../../../../../cn.zh-CN/API参考/磁盘/CreateDisk.md#)时，指定加密快照的 SnapshotId。

## 转换加密状态 {#convert .section}

已经创建的云盘，不能直接转换云盘的加密状态。已经创建的云盘创建的快照，不能直接转换快照的加密状态。

如果您需要转换数据的加密状态，您可以参考下表中的操作。

|转换的状态|Windows系统|Linux系统|
|:----|:--------|:------|
|将现有数据的非加密状态转换为加密状态|使用robocopy命令将数据从非加密盘复制到新建的加密盘。|使用rsync命令将数据从非加密盘复制到新建的加密盘。|
|将现有数据的加密状态转换为非加密状态|使用robocopy命令将数据从加密盘复制到新建的非加密盘。|使用rsync命令将数据从加密盘复制到新建的非加密盘。|

