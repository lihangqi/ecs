# 镜像加密 {#concept_gmr_nnr_bhb .concept}

ECS支持在复制镜像的过程中加入或更换密钥来生成新的加密镜像。您可以使用系统自建的密钥（CMK），也可以使用自己的密钥（BYOK）。

## 什么是镜像加密 {#section_ijf_131_chb .section}

当您的业务因为安全需求或法规合规要求等原因，需要对镜像中的数据进行加密保护时，您可以使用阿里云ECS镜像加密功能，无需构建、维护和保护自己的密钥管理基础设施，即可保护数据的隐私性和自主性。密钥管理服务（KMS）提供系统自建的用户主密钥（Customer Master Key，CMK），也支持BYOK模式，即由您上传密钥材料生成CMK，并托管在KMS中。您在加密镜像时，可以选择系统提供的CMK，也可以选择自己的密钥。

因此，首次通过控制台或者API使用ECS镜像加密功能之前，您必须先开通[密钥管理服务](https://www.aliyun.com/product/kms)。如果您使用系统提供的CMK，还需要开通[访问控制](https://www.aliyun.com/product/ram)，用于系统的授权操作。

## 镜像加密方式 {#dependencies .section}

支持的镜像加密方式包括：

-   非加密的自定义镜像复制为非加密的自定义镜像

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/136784/155316772140819_zh-CN.png)

    复制镜像不更改目标镜像的加密状态。

-   非加密的自定义镜像复制为加密的自定义镜像

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/136784/155316772140820_zh-CN.png)

    复制镜像更改目标镜像的加密状态。在复制镜像过程中，您需要提供加密密钥，加密后，您必须使用此密钥来访问使用目标镜像创建的实例。

-   加密的自定义镜像复制到加密的自定义镜像（不更换密钥）

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/136784/155316772140821_zh-CN.png)

    复制镜像不更改目标镜像的加密状态，且不更换密钥。加密的源镜像将在目标镜像中依然保持加密状态，您必须使用原有密钥访问该目标镜像创建的实例。

-   加密的自定义镜像复制到加密的自定义镜像（更换密钥）

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/136784/155316772140823_zh-CN.png)

    复制镜像保持镜像的加密状态，但更换密钥。在复制镜像过程中，您需要提供一个新的密钥。复制完成后，您必须使用新的密钥访问该目标镜像创建的实例。


## 使用限制 {#limits .section}

-   仅支持自定义镜像。
-   加密镜像不能复制为非加密镜像。
-   加密镜像不支持跨地域复制。
-   不支持共享加密镜像。
-   不支持导出加密镜像。
-   如果使用系统自动创建的（CMK），您不能删除它，但该CMK不收取费用。
-   不支持弹性裸金属服务器（神龙）。

## 费用 {#section_r4l_5r5_q8y .section}

|功能/操作|费用|
|:----|:-|
|ECS镜像加密功能|不收取额外的费用。|
|ECS为您在每个地域创建的用户主密钥（CMK）|属于服务密钥，不收取额外费用，也不占用您在每个地域的主密钥数量限制。|
|您自己在KMS上创建的CMK|属于普通密钥，会产生费用。|
|涉及镜像本身的管理操作，无论是通过ECS管理控制台还是通过API，均会以API的形式使用KMS，将会记入到您在该地域的KMS服务API调用次数| 目前每个用户每月可以免费使用20000次KMS，如果高频率大量操作超过免费额度，则会产生费用。详情请参见[密钥管理服务计费方式](https://help.aliyun.com/document_detail/52608.html)。

 |

**说明：** 请确保您的账户余额充足，否则会出现操作失败，进而产生额外的费用。

## 通过控制台加密镜像 {#howtocreate .section}

1.  登录ECS管理控制台。
2.  选择地域。
3.  在左侧导航栏中，选择**快照和镜像** \> **镜像**。
4.  在**自定义镜像**中选择要复制的镜像，并单击**复制镜像**。

    **说明：** 如果您要复制的自定义镜像大于200 GiB，需要提交工单处理。当您单击**复制镜像**时，系统会引导您提交工单。

5.  在复制镜像对话框中，完成加密设置。
    1.  选择**目标地域**。
    2.  填写镜像在目标地域显示的**自定义镜像名称**和**自定义镜像描述**。

        其中，自定义镜像描述会默认显示源镜像的相关信息，您可以修改此描述。

    3.  勾选**加密**，并选择密钥。

        您可以选择系统提供的CMK或者自带的密钥，用于加密或者更换密钥。

    4.  单击**确定**。
6.  切换到目标地域，查看自定义镜像的复制进度。当进度显示为100%时，说明任务完成。

## 通过API加密镜像 {#section_ern_2w4_xgb .section}

您也可以调用[CopyImage](cn.zh-CN/API参考/镜像/CopyImage.md#)复制镜像，指定一个KMSKeyId来加密镜像。

