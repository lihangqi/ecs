# 更换系统盘（非公共镜像） {#concept_vbb_ckj_ydb .concept}

更换系统盘是指为您重新分配一个系统盘（系统盘ID会更新），原来的系统盘会被释放。如果在创建ECS实例时选择了错误的操作系统，或者随着业务发展，需要扩大系统盘容量或者使用其他操作系统，您都能通过更换系统盘实现。

您能将系统盘的镜像更换为公共镜像、共享镜像、自定义镜像或镜像市场里的任一种镜像。

**说明：** 微软已经停止支持Windows Server 2003。为了保证您的数据安全，阿里云不推荐ECS实例继续使用Windows Server 2003系统，也不再提供这个镜像。更多信息，请参考 [关于阿里云不再支持Windows Server 2003系统镜像](https://www.alibabacloud.com/help/faq-detail/59513.htm)。

更换系统盘后，

-   您的实例会被分配一个新的系统盘，系统盘ID会更新，原系统盘被释放。

-   系统盘的云盘类型不能更换。

-   实例的IP地址和MAC地址不变。

-   为了保证有足够的快照额度完成新系统盘的自动快照策略，您可以 [删除不需要的旧系统盘快照](intl.zh-CN/用户指南/快照/删除快照和自动快照策略.md#)。


本文介绍如何将系统盘的镜像更换为非公共镜像。如果您需要使用公共镜像，请参考文档 [更换系统盘（公共镜像）](intl.zh-CN/用户指南/云盘/更换系统盘（公共镜像）.md#)。

## 注意事项 {#section_zdm_dkj_ydb .section}

更换系统盘是一个高风险操作，所以，在更换系统盘之前，请务必认真阅读以下注意事项。

**风险**

更换系统盘存在如下风险：

-   原系统盘的会被释放，建议您提前 [创建快照](intl.zh-CN/用户指南/快照/创建快照.md#) 备份数据。

-   更换系统盘需要停止实例，因此会中断您的业务。

-   更换完成后，您需要在新的系统盘中重新部署业务运行环境，有可能会对您的业务造成长时间的中断。

-   更换系统盘是重新为您的实例分配一个系统盘，磁盘ID会改变，所以基于旧的系统盘创建的快照将不能用于回滚新的系统盘。

    **说明：** 更换系统盘后，您手动创建的快照不受影响，您仍能用这些快照创建自定义镜像。如果您为旧的系统盘设置了自动快照策略，而且设置了自动快照随磁盘释放，则自动快照策略不再适用于新的系统盘，而且，旧系统盘的自动快照会自动删除。


**跨操作系统更换注意事项**

跨操作系统更换是指互相更换Windows与Linux系统。

**说明：** 非中国大陆的地域暂不支持Linux和Windows系统的互换，仅支持Linux不同发行版本或Windows不同版本之间的更换。

跨操作系统更换时，数据盘的文件系统格式可能会无法识别。

-   如果您的数据盘没有重要数据，建议您 [重新初始化数据盘](intl.zh-CN/用户指南/云盘/重新初始化云盘.md#)，再将其格式化为相应系统的默认文件系统。

-   如果您的数据盘上有重要数据，您需要做以下操作：

    -   Windows系统更换为Linux系统：需要单独安装软件识别，例如NTFS-3G等，因为Linux缺省情况下无法识别NTFS格式。
    -   Linux系统更换为Windows系统：需要单独安装软件识别，例如Ext2Read、Ext2Fsd等，因为Windows缺省情况下无法识别ext3、ext4、XFS等文件系统格式。

如果您将操作系统从Windows系统换为Linux系统，您能选择使用密码认证或SSH密钥对认证。

## 准备工作 {#section_f2m_dkj_ydb .section}

将系统盘的镜像更换为非公共镜像之前，您必须先完成以下工作：

-   如果更换为自定义镜像：

    -   如果要使用某台ECS实例上的镜像，您必须 [对指定实例的系统盘创建快照](intl.zh-CN/用户指南/快照/创建快照.md#)，并 [使用快照创建自定义镜像](intl.zh-CN/用户指南/镜像/创建自定义镜像/使用快照创建自定义镜像.md#)。如果这台实例与您要更换系统盘的实例不在同一个地域，您需要 [复制镜像](intl.zh-CN/用户指南/镜像/复制镜像.md#)。
    -   如果要使用本地物理镜像文件，您需要 [在控制台导入镜像](intl.zh-CN/用户指南/镜像/导入镜像/导入自定义镜像.md#) 或者 [使用Packer创建并导入本地镜像](intl.zh-CN/用户指南/镜像/镜像相关开源工具/使用 Packer 创建并导入本地镜像.md#)。镜像所在地域必须与您的实例相同。
    -   如果要使用其他地域的镜像，您需要先 [复制镜像](intl.zh-CN/用户指南/镜像/复制镜像.md#)。

        **说明：** 通过上述方式得到的镜像，在更换系统盘时，都出现在 **自定义镜像** 的下拉列表里。

-   如果要使用其他阿里云账号的镜像，您必须先 [共享镜像](intl.zh-CN/用户指南/镜像/共享镜像.md#)。

-   如果更换为Linux系统，而且选择SSH密钥对认证，您必须先 [创建SSH密钥对](intl.zh-CN/用户指南/密钥对/创建 SSH 密钥对.md#)。

-   因为更换系统盘是一个高危操作，可能会造成数据丢失或业务停止，为了最大限度地减少更换系统盘对您业务的影响，建议在更换系统盘之前先为当前系统盘 [创建快照](intl.zh-CN/用户指南/快照/创建快照.md#)。

-   如果要对Windows系统盘做更换，请确保系统盘有足够的空间。建议预留1 GiB的空间，否则系统盘更换后，系统可能无法正常启动。


**说明：** 避免在您的业务高峰期创建快照，以免影响业务。一个40 GiB的快照，第一次创建大约需要40分钟。因此请预留出足够的时间。而且，创建快照可能会降低块存储I/O性能（一般在10%以内），出现短暂瞬间变慢。

## 操作步骤 {#section_k2m_dkj_ydb .section}

1.  登录 [ECS管理控制台](https://ecs.console.aliyun.com/#/home)。
2.  在左侧导航栏里，单击 **实例**。
3.  选择地域。
4.  找到需要更换系统盘的实例，在 **操作** 列中，选择 **更多** \> **实例状态** \> **停止**。

    当实例状态变为 **已停止** 时，表示实例已经成功停止。

5.  在 **操作** 列中，选择 **更多** \> **磁盘和镜像** \> **更换系统盘**。
6.  在弹出的对话框里，仔细阅读更换系统盘注意事项后，单击 **确定，更换系统盘**。
7.  在 更换系统盘 页面上，
    1.  **镜像类型**：选择**自定义镜像**、**共享镜像** 或 **镜像市场**，并选择需要的镜像。
    2.  **系统盘**：不能更换系统盘的云盘类型，但是您能根据业务需求和新镜像的需求扩容系统盘，最大容量为500 GiB。扩容时能设置的最小容量与系统盘当前容量和镜像有关，如下表所示。

        |镜像|扩容的容量限制（GiB）|
        |:-|:-----------|
        |Linux（不包括CoreOS）+ FreeBSD|\[Max\{20, 系统盘当前容量\}, 500\]|
        |CoreOS|\[Max\{30, 系统盘当前容量\}, 500\]|
        |Windows|\[Max\{40, 系统盘当前容量\}, 500\]|

        **说明：** 如果您做过 [续费降配](intl.zh-CN/用户指南/实例/升降配/升降配概述.md#) 操作，进入下一个计费周期前，您不能修改系统盘容量。

    3.  **安全设置**：
        -   如果新的操作系统是Windows系统，您只能使用密码认证。
        -   如果您的实例是I/O优化实例，而且新的操作系统是Linux系统，您能选择使用密码认证或SSH密钥对认证。您必须设置登录密码或者绑定SSH密钥对。
    4.  确认 **配置费用**：包括镜像的价格与系统盘的价格。请详见 [云产品价格页](https://www.alibabacloud.com/zh/product/ecs#pricing)。
    5.  确认无误后，单击 **确定更换**。

登录ECS控制台监控系统状态，完成操作系统更换大概需要10分钟。完成后，实例会自动启动。

## 后续操作 {#section_v2m_dkj_ydb .section}

更换系统盘后，您可能需要做以下操作：

-   （可选）[为新的系统盘设置自动快照策略](intl.zh-CN/用户指南/快照/为磁盘设置自动快照策略.md#)。自动快照策略与磁盘ID绑定。更换了新的系统盘后，旧磁盘上应用的自动快照策略自动失效。您需要对新系统盘设置自动快照策略。

-   如果更换前后都是Linux系统，而且，实例上原来挂载了数据盘并设置了开机自动挂载分区：更换系统盘后，原来系统盘中的数据盘分区挂载信息丢失。您必须在新系统盘的/etc/fstab文件写入新分区信息，并挂载分区，不需要对数据盘格式化并分区。操作步骤如下，具体的操作命令参考 [Linux格式化和挂载数据盘](../../../../intl.zh-CN/个人版快速入门/步骤 4：格式化数据盘/Linux 格式化数据盘.md#)：

    1.  （建议）备份etc/fstab。
    2.  向/etc/fstab写入新分区信息。
    3.  查看/etc/fstab中的新分区信息。
    4.  运行 `mount` 命令挂载分区。
    5.  查看文件系统空间和使用情况：运行命令`df -h`。

        挂载操作完成后，不需要重启实例即可开始使用新的数据盘。


## 相关API {#section_y2m_dkj_ydb .section}

[ReplaceSystemDisk](../../../../intl.zh-CN/API参考/磁盘/ReplaceSystemDisk.md#)

